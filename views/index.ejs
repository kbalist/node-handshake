<div id="rightCol">
    <pre id="messages" style="max-height:300px; overflow:auto;"></pre>

    <form method="post" id="message-form">
      <input type="text" placeholder="Type your message" id="message-input" name="message" autofocus required>
      <input type="submit" value="OK">
    </form>
</div>
<div id="leftCol">
    
</div>

<script type="text/javascript">
	
	/* locators */
	var messageInput = $('#message-input');
	var messagesArea = $('#messages');
	var itemsArea = $('#leftCol');
	
	/* Form */
	document.getElementById('message-form').onsubmit = function () {
	  socket.emit('write', messageInput.value);
	  messageInput.value = '';
	  return false;
	}
 
	/* Display */
	function addMessage(username, message, time) {
	  if (typeof time != 'string') {
	    var date = new Date(time);
	    time = date.getHours() + ':' + date.getMinutes() + ':' + date.getSeconds();
	  }
	  var line = '[' + time + '] <strong>' + username + '</strong>: ' + message + '<br />';
	  messagesArea.prepend( line );
	}
	
	/* Display */
	function addItem(item) {
        itemsArea.append('<section>' + item.name + '</section>');
	}
	
	function addItems(items) {
        for(i=0; i<items.length; i++){
            addItem(items[i]);
        }
	}
	
</script>


<script type="text/javascript">
/** Socket */
var sio = io.connect(), 
	socket = sio.socket.of('/chat');


socket
.on('join', function (username, time) {
  // someone joined room
  addMessage(username, 'joined room', time);
})
.on('bye', function (username, time) {
  // someone left room
  addMessage(username, 'left room', time);
})
.on('message', function (username, message, time) {
  // someone wrote a message
  addMessage(username, message, time);
});

/* new implementation */
socket
.on('connect', function () {
  // I'm connected
	alert("Welcome <%= username %>");
})
.on('error', function (error) {
  // an error occured
  alert('Error: ' + error);
})

.on('model', function (model) {
//	console.log(model);
    addItems(model)
})


</script>
